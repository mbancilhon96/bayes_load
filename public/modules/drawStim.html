<div id="directions">

<h1>Sample</h1>


<!-- <img src="modules/secondary_demo.jpg" width="100%">
 -->
<!--  <img src="modules/calibration_gif3.gif" width="100%">
 -->
<div id="viewPatternDiv">
 <p>You will be presented with a dot pattern for 850 milliseconds that you will have to keep it in mind while solving a problem. Click on the button to reveal the pattern.</p>
 <button id="viewPattern" class="example_c" onclick="drawSample()">View Pattern</button>
</div>

<div id="testContainer">
	<p>Click on the squares where the dots were located</p>
</div>

<svg id="gridContainer" width=600 height=600></svg>

<button id="start" type="button">Next</button>

</p>
</div>

<style>
        #images {
                
        }
</style>

<script>
var rects=["0","1","2","3","4","5","6","7","8"]
var dots
var data={}
var timeoutSample

document.getElementById('viewPatternDiv').style.display="block"
document.getElementById('testContainer').style.display="none"
document.getElementById('start').style.display="none"

function drawSample(){
	document.getElementById('viewPatternDiv').style.display="none"
	document.getElementById('testContainer').style.display="none"


	dots=shuffle(rects).slice(0,4) //shuffle array, pick 4

	console.log("dots is ",dots)
	console.log(experimentr.get_currentId())

	console.log("clicked")
	d3.select('svg')
		.selectAll('rect')
		.data(rects)
		.enter()
	  	.append('rect')
	  	.attr("id",function(d,i){
	  		return d
	  	})
	  	.attr("x",function(d,i){
	  		return ((d%3)+1)*100
	  	})
	  	.attr("y",function(d,i){
	  		return Math.floor(d/3)*100
	  	})
	  	.attr("width",100)
	  	.attr("height",100)
	  	.attr("fill","white")
	  	.style("stroke","black")
	  	.style("stroke-width", 0.5);

	d3.select('svg')
		.selectAll('circle')
		.data(dots)
		.enter()
		.append("circle")
	  	.attr("id",function(d,i){
	  		return d
	  	})
	  	.attr("cx",function(d,i){
	  		return ((d%3)+1)*100 + 50
	  	})
	  	.attr("cy",function(d,i){
	  		return Math.floor(d/3)*100 + 50
	  	})
	  	.attr("r",15)

	timeoutSample=setTimeout(function(){
		experimentr.addData(data)
		experimentr.next()	
	},850)

}
function drawTest(){
	document.getElementById('viewPatternDiv').style.display="none"
	document.getElementById('testContainer').style.display="block"
	document.getElementById('start').style.display="block"

	var userAnswer=[]

	d3.select('svg')
		.selectAll('rect')
		.data(rects)
		.enter()
	  	.append('rect')
	  	.attr("id",function(d,i){
	  		return d
	  	})
	  	.attr("x",function(d,i){
	  		return ((d%3)+1)*100
	  	})
	  	.attr("y",function(d,i){
	  		return Math.floor(d/3)*100
	  	})
	  	.attr("width",100)
	  	.attr("height",100)
	  	.attr("fill","white")
	  	.style("stroke","black")
	  	.style("stroke-width", 0.5)
	  	.on("click",function(d,i){
	  		if (this.getAttribute("fill")=="lightgrey"){
	  			this.setAttribute("fill","white")
	  			userAnswer.pop(this.id)
	  		}
	  		else if (this.getAttribute("fill")=="white"){
		  		this.setAttribute("fill","lightgrey")
		  		userAnswer.push(this.id)
	  		}

	  	})

	d3.select('#start').on('click', function(){
		console.log("userAnswer is ",userAnswer)
		let checker = (arr1, arr2) => arr2.every(v => arr1.includes(v));
		arrEqual=checker(dots,userAnswer)
		console.log("arrEqual is is ",arrEqual)
		if (arrEqual){
			console.log("loadTaskCorrect")
			data['loadTaskCorrect']=1
            experimentr.addBonuses(0.5,experimentr.get_currentId())
            experimentr.addBonus(0.5)
		}
		else{
			console.log("loadTaskIncorrect")
			data['loadTaskCorrect']=0
            experimentr.addBonuses(0,experimentr.get_currentId())
            experimentr.addBonus(0)
		}
		experimentr.addData(data)
		console.log("DATA IS ",experimentr.getData())
		experimentr.next()	
	}); 	

}
if (experimentr.get_currentId()!=2){
	drawTest()
}


experimentr.hideNext(); 


function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }
  return array;
}

</script>